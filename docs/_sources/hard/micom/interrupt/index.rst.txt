.. index:: Interrupt, 割り込み

.. _Interrupt:

Interrupt(割り込み)
========================
| マイコンがハード的に一定の条件を満たした時に発生するイベントの事である。
| このイベントによって実行される処理を割り込み処理という。
| 現行の処理を中断して割り込み処理が行われるため、
| 割り込みが発生して欲しくない処理を行う際は  :ref:`DI` をし、
| その処理が終わり次第 :ref:`EI` を行う。
| この割り込み禁止をしている時間(通称：割禁時間)は短ければ短いほどほかの処理に与える影響が低くなるため、
| 必要最低限の処理のみを割禁時間とするように設計する。

.. note::

    | 例えばボーレート115200bpsでUART通信を行っている場合、1バイト毎の受信完了割り込みは
    | > 1[s] * 1000[ms] * 1000[μs] / 115200 = 約8.68μs毎
    | に発生する。この時に9μs以上割り禁を行うと受信したデータをロストしてしまうことになる。

.. index:: IRQ

.. _IRQ:

IRQ(Interrupt ReQuest:割り込み要求)
======================================
| 名前の通り割り込みの要求そのもの。
| これに数字を追加して割り込みを番号で呼ぶこともある。

.. index:: External Interrupt, 外部割り込み

.. _ExtInt:

External Interrupt(外部割り込み)
======================================
| 外部からの要因で発生する割り込みの事。
| 端子の状態による割り込みや、通信結果の割り込みがこれにあたる。

.. index:: Internal Interrupt, 内部割り込み

.. _IntInt:

Internal Interrupt(内部割り込み)
====================================
| マイコン自身が発生させる割り込みの事。
| 内部で仕掛けたタイマや、 :ref:`例外` 等がこれにあたる。


.. index:: Interrupt Priority, 割り込み優先度

.. _Priority:

Interruput Priority(割り込み優先度)
==============================================
| 割り込みが発生した際の実行優先度
| 各割り込みには個別で優先度を設定できる。
| その優先度に従い、発生時の実行順番を制御する。
| 割り込み発生中に他の割り込みが動作する事を多重割り込みと言い、制御が非常に複雑になる。
| その為、意図的に優先度を全て等しくし、多重割り込みを発生させないようにする場合もある。

.. seqdiag::

    seqdiag {
        common[label = "Common"];
        high[label = "High Priority\nInterrupt"];
        low[label = "Low Priority\nInterrupt"];
        common => low;
        common => high;
        common => low {
            low => high;
        }
    }

.. index:: Mask

.. _Mask:

Mask
============================
| 覆い隠す事。
| 大抵組み込みでは割り込みに対して使用する言葉
| Maskすることで、Mask中は該当する割り込みは実行を待機することになる。
| :ref:`Priority` のレベルを指定する事で、そのレベル以下の割り込みのみをMaskすることもできる。


.. index:: NMI

.. _NMI:

NMI
============================
| Non Maskable Interrupt
| :ref:`Priority` が最も高く、 :ref:`Mask` 不可能な割り込みの事。
| まあ、 :ref:`Reset` の事である。

.. index:: Reset

.. _Reset:

Reset
============================
| マイコンの動作を全て初期状態に戻す為の割り込みの事。
| 外部Watckdogが居る場合、大抵この割り込み端子を制御させることになる。


.. index:: 例外

.. _例外:

例外
===========
| マイコンが異常を検知した場合、例外が発生する。
| 割り込みとは異なり、分かり易く表現するとマイコン自体の悲鳴である。
| 動作保障外の電圧への低下、 :ref:`Alignment` 不正アクセス、予約領域へのアクセス等で発生する。
| :ref:`ベクタテーブル` が通常のものに埋め込まれているマイコンと、別途存在するマイコンがある。
