.. index:: システム仕様書

.. _システム仕様書:

システム仕様書
==================
| 顧客要求仕様書を受け、マイコン同士の構成やその分担内容を定義したもの

概要
---------

| 納入する実物として基盤や搭載するマイコンの選定を行い、
| それら各マイコンの役割分担等を示したもの。
| 母体を引き継いでの開発となる場合、その母体の全貌を把握するために最も有用な資料である。
| ただ、母体からの改修を繰り返して作成される物である為、
| 資料間の齟齬があったり、複数資料を見渡して初めて一つの機能の説明になるものがあったりする。
| 可能ならば関係無いと思われる範囲の資料も軽く一通り目を通しておくべき。

.. note::
    | この仕様書に書かれている内容は基本的に母体のソースコードと密接に関わりがある。
    | その為、記述内容があやふやだったり、母体のソースコードと差異があったりする場合がある。
    | それらの内容については、母体を知っている人からどうしてそうしたのか話を聞くべきである。

.. warning::
    | 母体があるからこそ「こう変えました」って言えば伝わるだろうと高を括られている個所でもある。
    | 記述だけを見て想定するものと、期待されているものは大きく異なる場合がある為、
    | 記述内容がソースコードのどのあたりを指していて、
    | それに対してどの辺を変えれば出来るだろうと期待されているのかを
    | 認識することが不可欠となる。

内容
-----------
| 種類としては以下のようなものがある。
| これらは必ずこう分かれているというものではなく、あくまで指標である。

**ブロック定義**
    | 開発を担当する基盤やそれに接続されているモジュールはどのように繋がっているのかを示したもの。
    | 通信を行うのであればその通信規格まで記載がある。

    .. note::
        | 開発する基盤を俯瞰する際に最も役に立つ仕様書である。
        | 通信などのマイコン間の連携での開発や不具合調査をする際には、
        | 一度目を通し接続対象を知っておくと想定外の事態が起こりにくくなる。

**端子割り当て**
    | 各マイコンの端子についてそれぞれの接続先と設定内容が記載されている。
    | 基本的に起動時の初期値が記載されている。
    | 停止中もリセットがかからず電源が印加され続けるマイコンについてはその状態への言及もある。
    | これは電源OFFの状態での待機電力を下げる目的がある。

    .. note::
        | マイコンのピンの数だけ記載がある為、ある意味最も情報量が多い仕様書でもある。
        | その分最も記述ミスが起こりやすい為、特に開発の初期段階では仕様書のダブルチェックをするくらいの気持ちで読むこと。

**電源シーケンス**
    | 電源が操作された際にどのように基盤に電源を印加していくのかを示した仕様書。
    | 基盤が変わることにより電源モジュールやその他搭載チップ等がそれなりに変化する為、
    | 母体継承開発でも基盤が変わればそれなりに変更量が出る個所であり、
    | 動作の根幹部分の為不具合があると非常に面倒なことになる個所でもある。
    | また、根幹部分過ぎる為顧客から見れば出来ていて当然の個所でもある。

    .. note::
        | 制御する端子の数の多さが断トツで多く、その為に動作確認が非常に面倒な機能の一つである。
        | 組み込み開発とはソフトとハードが混ざり合う開発であることが最もよくわかるドキュメントでもある。

**マイコン機能書**
    | 開発を行うマイコン毎に担当する機能についてある程度詳しく記載がある。
    | マイコンに接続されている他のマイコンやチップをどう制御するのかが主に書かれている。

**コマンド仕様書**
    | 基盤上のマイコン間で行う通信のコマンド内容についての仕様書。
    | これを共通で定めることで送信したバイナリ列が受信側で正しく処理されるようになる。

**異常判定仕様書**
    | 基盤上で異常を検知した際にどのようにフェールを働かせるのか、
    | またどのように復帰させるのかを示す仕様書。
    | とはいえ基盤上で起こりうる異常全てに対して記述があるわけではない。

    .. warning::
        | 基本的に単発で記載されており、複数の異常が競合した場合等については記載されていない場合が多い。

**基盤回路図**
    | :ref:`ECU` の回路図である。
    | 実機の動作確認をする際には非常にお世話になる。
    | 電子回路図がそのまま描かれており、前提の知識が無いと非常にハードルが高い。
    | しかし、単に接続先が知りたい場合などは単純に線を辿ればいいので初心者でも可能である。
    | 当然のことながら電子回路図が読めれば更に理解が深まる。

    .. note::
        | 試験時に実際の端子や配線の状態を知りたい時が出てくるが、マイコンの形状によっては端子が隠れて見えないものがある。
        | そんなときの為に基盤にはそれっぽい配線はテストポイントとして露出してくれていたりする。
        | しかしそれがどこかわからない時やそもそも無い場合もある為、回路図から目的の端子と同じ値が読みだせる個所を見つける必要がある。
        | 大抵の場合それは接続相手の端子だったりする。

**基盤配線図**
    | :ref:`ECU` の実際の配線図である。
    | 基盤自体は大抵4層以上の積層構造となっており、表面だけで見える配線を辿って理解することは出来ない。
    | 上記基盤回路図を実際に基盤にどう配置されているのかが示されている。
    | デバッグ時にどこを触ればいいのかを調べるために有用である。
